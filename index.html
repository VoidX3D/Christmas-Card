<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Christmas Card for You</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #c0392b; /* Christmas Red */
            --color-secondary: #27ae60; /* Christmas Green */
            --color-accent: #f1c40f; /* Gold */
            --color-text-light: #ecf0f1;
            --color-text-dark: #34495e;
            --glass-blur: 20px;
            --glass-saturate: 150%;
        }

        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #0a1332; /* Fallback background */
        }

        .background-iframe-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #background-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        #snow-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2; /* Behind glass */
            pointer-events: none;
        }

        .glass-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(10px) saturate(var(--glass-saturate));
            -webkit-backdrop-filter: blur(10px) saturate(var(--glass-saturate));
            background: none; /* Fully transparent */
            z-index: 3; /* Above snow */
            pointer-events: none;
        }

        .card-container {
            position: relative;
            width: 90vmin;
            max-width: 500px;
            height: 60vmin;
            max-height: 350px;
            perspective: 1200px;
            z-index: 100; /* Above all other layers */
        }

        .envelope-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform: rotateX(10deg) rotateY(-10deg);
            transition: transform 1s ease;
            cursor: pointer;
            opacity: 0; /* Initially hidden */
        }
        
        .envelope-wrapper:hover {
            transform: rotateX(0deg) rotateY(0deg) scale(1.05);
        }

        .envelope {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--color-primary);
            border-radius: 10px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            transform-style: preserve-3d;
        }

        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 52%;
            background: linear-gradient(to bottom, #d64545, var(--color-primary));
            clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 50% 25%, 0% 100%);
            transform-origin: top center;
            z-index: 12;
        }

        .letter {
            position: absolute;
            width: 95%;
            height: 95%;
            background-color: #f7f7f7;
            border-radius: 5px;
            top: 2.5%;
            left: 2.5%;
            transform: translateY(50%) translateZ(-100px);
            box-shadow: 0 5px 25px rgba(0,0,0,0.3);
            z-index: 5;
            opacity: 0;
            padding: 1.5rem;
            box-sizing: border-box;
            color: var(--color-text-dark);
            text-align: center;
        }

        .letter h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: var(--color-primary);
            margin: 0;
        }

        .letter p {
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .letter .signature {
            font-family: 'Roboto', sans-serif;
            font-size: 0.9rem;
            text-align: right;
            margin-top: 1rem;
        }

        .ribbon-wrapper {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 11;
        }
        
        .ribbon {
            position: absolute;
            background: linear-gradient(90deg, var(--color-secondary) 33%, #fff 33%, #fff 66%, var(--color-primary) 66%);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .ribbon.vertical {
            width: 30px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }

        .ribbon.horizontal {
            width: 100%;
            height: 30px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .stamp {
            position: absolute;
            width: 70px;
            height: 70px;
            background-color: #fff;
            border-radius: 50%;
            top: 20%;
            right: 15%;
            transform: rotate(15deg);
            box-shadow: 0 5px 10px rgba(0,0,0,0.3);
            border: 3px solid var(--color-accent);
            z-index: 12;
            pointer-events: auto; /* Clickable */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: var(--color-accent);
        }

        .decoration {
            position: absolute;
            z-index: 5;
            pointer-events: none;
            opacity: 0.8;
            bottom: 0; /* Position at the bottom */
        }

        .decoration svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.5));
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .twinkle {
            animation: twinkle 2s infinite;
        }

        #reindeer-sleigh {
            transform: translateY(-50px);
        }


        .garland {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 200;
            pointer-events: none;
        }

        .lights {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 201;
        }
        
        .light {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px currentColor;
        }

        .envelope-message {
            color: var(--color-text-light);
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            text-align: left;
            line-height: 1.5;
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .envelope-message .to-text {
            font-weight: 700;
            font-size: 1.4rem;
        }

        .envelope-message .from-text {
            font-style: italic;
            margin-top: 0.5rem;
            font-size: 1rem;
        }

    </style>
</head>
<body>

    <div class="background-iframe-container">
        <iframe id="background-iframe" src="assets/background.html"></iframe>
    </div>
    <div class="glass-layer"></div>
    <canvas id="snow-canvas"></canvas>

    <!-- New Decorations -->
    <svg class="garland" viewBox="0 0 1000 100">
        <path d="M0,50 C100,0 200,100 300,50 S500,0 600,50 S800,100 900,50 S1100,0 1200,50" fill="none" stroke="#1E8449" stroke-width="5"/>
    </svg>
    <div class="lights">
        <div class="light" style="background-color: #f1c40f; top: 5%; left: 10%;"></div>
        <div class="light" style="background-color: #e74c3c; top: 10%; left: 25%;"></div>
        <div class="light" style="background-color: #3498db; top: 8%; left: 45%;"></div>
        <div class="light" style="background-color: #9b59b6; top: 6%; left: 65%;"></div>
        <div class="light" style="background-color: #2ecc71; top: 9%; left: 85%;"></div>
    </div>


    <!-- Decorations -->
    <div class="decoration" id="reindeer-sleigh" style="width: 200px; top: 5%; left: -200px;">
        <svg viewBox="0 0 200 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M150 70 Q140 60 130 70" stroke="#8B4513" stroke-width="3" fill="none"/>
            <path d="M130 70 L120 80 L110 70" stroke="#8B4513" stroke-width="3" fill="none"/>
            <path d="M120 80 L120 90" stroke="#8B4513" stroke-width="3" fill="none"/>
            <path d="M115 90 L125 90" stroke="#8B4513" stroke-width="3" fill="none"/>
            <path d="M50 80 H100 V95 H50 Z" fill="#c0392b"/>
            <path d="M45 80 L50 80" stroke="black" stroke-width="2"/>
            <path d="M45 95 L50 95" stroke="black" stroke-width="2"/>
        </svg>
    </div>
    <div class="decoration" id="gifts" style="width: 120px; bottom: 5%; left: 5%;">
        <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="10" y="50" width="40" height="40" fill="#27ae60"/>
            <rect x="5" y="65" width="50" height="10" fill="#f1c40f"/>
            <rect x="25" y="50" width="10" height="40" fill="#f1c40f"/>
            <rect x="60" y="60" width="30" height="30" fill="#c0392b"/>
            <rect x="55" y="70" width="40" height="10" fill="#f1c40f"/>
            <rect x="70" y="60" width="10" height="30" fill="#f1c40f"/>
        </svg>
    </div>
    <div class="decoration" id="tree" style="width: 130px; bottom: 5%; right: 5%;">
        <svg viewBox="0 0 100 120" fill="none" xmlns="http://www.w3.org/2000/svg">
            <polygon points="50,0 20,40 40,40 10,80 30,80 0,120 100,120 70,80 90,80 60,40 80,40" fill="#1E8449"/>
            <circle cx="50" cy="10" r="5" fill="#f1c40f"/>
            <circle cx="40" cy="50" r="4" fill="#c0392b" class="twinkle"/>
            <circle cx="60" cy="50" r="4" fill="#e74c3c" class="twinkle"/>
            <circle cx="30" cy="90" r="3" fill="#3498db" class="twinkle"/>
            <circle cx="70" cy="90" r="3" fill="#9b59b6" class="twinkle"/>
        </svg>
    </div>

    <div class="card-container">
        <div class="envelope-wrapper">
            <div class="envelope">
                <div class="letter">
                    <h1>Merry Christmas!</h1>
                    <p>
                        Hope your day went well!<br>
                        Thinking of you all in the Netherlands.<br>
                        Wishing you peace, health, and warm moments together.<br>
                        May this season bring a little extra joy!<br>
                        Miss you and can’t wait to see you again.
                    </p>
                    <p class="signature">— Sincere Bhattarai</p>
                </div>
                <div class="envelope-flap">
                    <div class="envelope-message">
                        To: Marije Schte<br><br>
                        From: Sincere Bhattarai
                    </div>
                </div>
            </div>
            <div class="ribbon-wrapper">
                <div class="ribbon vertical"></div>
                <div class="ribbon horizontal"></div>
                <div class="stamp">❆</div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const snowCanvas = document.getElementById('snow-canvas');
            const snowCtx = snowCanvas.getContext('2d');
            let snowflakes = [];
            const numSnowflakes = 150;
            const snowflakeShapes = ['\u2744', '\u2745', '\u2746'];

            function resizeCanvas() {
                snowCanvas.width = window.innerWidth;
                snowCanvas.height = window.innerHeight;
            }

            function createSnowflakes() {
                snowflakes = [];
                for (let i = 0; i < numSnowflakes; i++) {
                    snowflakes.push({
                        x: Math.random() * snowCanvas.width,
                        y: Math.random() * snowCanvas.height,
                        size: Math.random() * 15 + 5,
                        speed: Math.random() * 1 + 0.5,
                        drift: Math.random() * 0.5 - 0.25,
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.01,
                        shape: snowflakeShapes[Math.floor(Math.random() * snowflakeShapes.length)],
                        opacity: Math.random() * 0.7 + 0.3
                    });
                }
            }

            function drawSnowflakes() {
                snowCtx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
                snowflakes.forEach(flake => {
                    flake.y += flake.speed;
                    flake.x += flake.drift;
                    flake.rotation += flake.rotationSpeed;
                    if (flake.y > snowCanvas.height) {
                        flake.y = -flake.size;
                        flake.x = Math.random() * snowCanvas.width;
                    }
                    snowCtx.save();
                    snowCtx.globalAlpha = flake.opacity;
                    snowCtx.fillStyle = 'white';
                    snowCtx.font = `${flake.size}px Arial`;
                    snowCtx.translate(flake.x, flake.y);
                    snowCtx.rotate(flake.rotation);
                    snowCtx.fillText(flake.shape, 0, 0);
                    snowCtx.restore();
                });
                requestAnimationFrame(drawSnowflakes);
            }

            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
            createSnowflakes();
            drawSnowflakes();

            // --- Animations ---
            const envelopeWrapper = document.querySelector('.envelope-wrapper');
            const stamp = document.querySelector('.stamp');
            const ribbonWrapper = document.querySelector('.ribbon-wrapper');
            const envelopeFlap = document.querySelector('.envelope-flap');
            const letter = document.querySelector('.letter');
            const decorations = document.querySelectorAll('.decoration');
            
            let opened = false;
            
            // Initial reveal animation
            anime({
                targets: envelopeWrapper,
                translateY: ['-100vh', '0%'],
                opacity: [0, 1],
                rotateX: '10deg',
                rotateY: '-10deg',
                duration: 2000,
                easing: 'easeOutExpo',
                delay: 500,
            });

            // Decoration animation
            anime({
                targets: '.decoration:not(#reindeer-sleigh)',
                translateY: (el, i) => i % 2 === 0 ? '-15px' : '15px',
                translateX: (el, i) => i % 2 === 0 ? '10px' : '-10px',
                scale: [1, 1.05, 1],
                loop: true,
                direction: 'alternate',
                easing: 'easeInOutSine',
                duration: 4000,
                delay: anime.random(0, 1000),
            });

            // Twinkling lights animation
            anime({
                targets: '.light',
                opacity: [0, 1],
                duration: 1000,
                direction: 'alternate',
                loop: true,
                easing: 'easeInOutSine',
                delay: anime.random(0, 1000),
            });


            // Flying reindeer animation
            anime({
                targets: '#reindeer-sleigh',
                translateX: '110vw',
                duration: 20000,
                easing: 'linear',
                loop: true,
                delay: 2000,
            });

            const openCard = () => {
                if (opened) return;
                opened = true;
                
                anime.timeline({
                    easing: 'easeOutExpo',
                })
                .add({
                    targets: [stamp, ribbonWrapper],
                    translateY: '-200%',
                    rotate: '45deg',
                    opacity: 0,
                    duration: 1200,
                })
                .add({
                    targets: envelopeFlap,
                    rotateX: '-180deg',
                    duration: 1000,
                    easing: 'easeInOutCubic',
                }, '-=800')
                .add({
                    targets: letter,
                    translateY: ['50%', '0%'],
                    translateZ: ['-100px', '100px'],
                    opacity: 1,
                    duration: 1500,
                }, '-=1000');
            };
            
            envelopeWrapper.addEventListener('click', openCard);
        });
    </script>
</body>
</html>